{% extends 'home/base.html' %}
{% load static %}

{% block styling %}
<link rel="stylesheet" href="{% static 'accommodation/css/hotel_images.css' %}">
{% endblock styling %}

{% block content %}
<div class="gallery-container" style="padding-top: 6rem; padding-bottom: 4rem;">
    <h1>Manage Hotel Images</h1>

    <!-- Add Image Section -->
    <div class="add-image-section">
        <button id="addImageButton" onclick="openPopup()">Add Image</button>
    </div>

    <!-- Image Gallery -->
    <div class="card-container" id="imageGallery">
        <!-- Images will be dynamically loaded here -->
    </div>
</div>

<!-- Popup for Adding Image -->
<div id="imagePopup" class="modal" style="display: none;">
    <div class="modal-content">
        <h2>Upload Image</h2>
        <input type="file" id="fileInput" accept="image/*">
        <button id="uploadButton" onclick="uploadImage()">Upload File</button>
        <button id="closePopupButton" class="close-btn" onclick="closePopup()">Close</button>
    </div>
</div>

{% endblock content %}

{% block javascript %}
<script>
    const imageGallery = document.getElementById('imageGallery');
    const popup = document.getElementById('imagePopup');
    const fileInput = document.getElementById('fileInput');

    // Open the popup
    function openPopup() {
        popup.style.display = 'flex';
    }

    // Close the popup
    function closePopup() {
        popup.style.display = 'none';
        fileInput.value = ''; // Clear the file input
    }

    function createImageCard(src, id) {
        const card = document.createElement('div');
        card.classList.add('card');
        card.setAttribute('data-id', id);

        const img = document.createElement('img');
        img.src = src;
        img.alt = "Hotel Image";

        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.classList.add('delete-btn');
        deleteButton.onclick = function () {
            deleteImage(this, id);
        };

        card.appendChild(img);
        card.appendChild(deleteButton);

        return card;
    }

    // Upload Image
    function uploadImage() {
        const file = fileInput.files[0];
        if (file) {
            const formData = new FormData();
            formData.append('image', file);

            // Replace '/upload-image/' with your actual upload endpoint
            fetch('/upload-image/', {
                method: 'POST',
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    const newCard = createImageCard(data.image_url, data.image_id); // Use returned image URL and ID
                    imageGallery.appendChild(newCard);
                    closePopup(); // Close popup after successful upload
                } else {
                    alert('Failed to upload image.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error uploading image.');
            });
        } else {
            alert('Please select an image to upload.');
        }
    }

    // Delete Image
    function deleteImage(button, imageId) {
        const card = button.parentElement;

        // Replace '/delete-image/' with your actual delete endpoint
        fetch(`/delete-image/${imageId}/`, {
            method: 'DELETE',
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                card.remove();
            } else {
                alert('Failed to delete image.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error deleting image.');
        });
    }
</script>
{% endblock javascript %}
